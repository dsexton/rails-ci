FROM buildpack-deps:jessie

COPY ./scripts /scripts

# Install Install Essentials
RUN /scripts/install-essentials

RUN echo "en_US.UTF-8 UTF-8" > /etc/locale.gen
RUN locale-gen en_US.UTF-8
ENV LANG en_US.UTF-8
ENV LANGUAGE en_US:en
ENV LC_ALL en_US.UTF-8

# Install ZeroMQ
RUN /scripts/install-zeromq

# Install Docker
ONBUILD ARG DOCKER_INSTALL_CHANNEL=stable
ONBUILD ARG DOCKER_INSTALL_VERSION=17.09.0-ce
ONBUILD RUN /scripts/install-docker $DOCKER_INSTALL_CHANNEL $DOCKER_INSTALL_VERSION

# Install Docker Compose
ONBUILD ARG DOCKER_COMPOSE_INSTALL_VERSION=1.17.0
ONBUILD RUN /scripts/install-docker-compose $DOCKER_COMPOSE_INSTALL_VERSION

# Install Node
ONBUILD ARG NODE_INSTALL_VERSION=9.2.0
ONBUILD RUN /scripts/install-node $NODE_INSTALL_VERSION

# Install PhantomJS
ONBUILD ARG PHANTOMJS_INSTALL_VERSION=2.1.1
ONBUILD RUN /scripts/install-phantomjs $PHANTOMJS_INSTALL_VERSION

# Install Ruby
ONBUILD ARG RUBY_INSTALL_MAJOR=2.4
ONBUILD ARG RUBY_INSTALL_VERSION=2.4.2
ONBUILD ARG RUBYGEMS_INSTALL_VERSION=2.7.2
ONBUILD ARG BUNDLER_INSTALL_VERSION=1.16.0
ONBUILD RUN /scripts/install-ruby $RUBY_INSTALL_MAJOR $RUBY_INSTALL_VERSION $RUBYGEMS_INSTALL_VERSION $BUNDLER_INSTALL_VERSION

# Set Ruby environment variables
ENV GEM_HOME /usr/local/bundle
ENV BUNDLE_PATH="$GEM_HOME" \
	BUNDLE_BIN="$GEM_HOME/bin" \
	BUNDLE_SILENCE_ROOT_WARNING=1 \
	BUNDLE_APP_CONFIG="$GEM_HOME"
ENV PATH $BUNDLE_BIN:$PATH

# Set Rails to run in test
ENV RAILS_ENV test
ENV RACK_ENV test
